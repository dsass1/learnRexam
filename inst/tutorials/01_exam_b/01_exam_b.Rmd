---
title: "Exam 1"
tutorial:
  id: "isds_exam1b"
  version: 0.1
  
output:
  ISDSfunctions::tutorial:
    progressive: false
    allow_skip: true
runtime: shiny_prerendered
description: >
  This proficiency exam covers Preface - Chapter 4.
---

```{r setup, include=FALSE}
library(learnr)
library(tidyverse)
library(ISDSfunctions)
library(gradethis)
library(skimr)

gradethis_setup()

isds_setup(isds_exam = TRUE)

knitr::opts_chunk$set(echo = FALSE)

survey <- read_rds("data/survey.rds") %>%
  # remove impossible data and extreme outliers
  mutate(
    followers_insta = ifelse(followers_insta == 0, NA,
                           ifelse(followers_insta > 4000, NA,
                                  followers_insta)),
    followers_tiktok = ifelse(followers_tiktok == 0, NA,
                           ifelse(followers_tiktok > 4000, NA,
                                  followers_tiktok)),
    height_inches = ifelse(height_inches < 42, NA,
                           ifelse(height_inches > 84, NA,
                                  height_inches)),
    mother_height = ifelse(mother_height < 42, NA,
                           ifelse(mother_height > 84, NA,
                                  mother_height)),
    father_height = ifelse(father_height < 42, NA,
                           ifelse(father_height > 84, NA,
                                  father_height)),
    salary = ifelse(salary < 500000, salary, NA),
    smoke_weed = ifelse(smoke_weed == "Occasionally", "Yes", smoke_weed)
    ) %>% 
  select(quarter, gender_ident, school_year, num_party, procrastinator, 
          height_inches, happy, campus_housing, smoke_weed,
         followers_insta, followers_tiktok, salary)
  
```


```{r, context = "server"}
lock_server("lock", 
            ex = c("App1", "App2", "App3", "App4"), ex_pts = c(4, 4, 2, 3),
            manual = c("App1-desc", "App4-desc"), manual_pts = c(1, 1))
#reset_server("reset")
```

```{r Name2}
# student name
question_blank("Name: ___",
              answer_fn(function(value){
                              if(length(value) >= 1 ) {
                                return(mark_as(TRUE))
                                }
                              return(mark_as(FALSE) )
                              }),
              correct = "Submitted",
              incorrect = "Submitted",
              allow_retry = FALSE )
```


```{r Name}
# student name
question_text("Name:",
              answer_fn(function(value){
                              if(length(value) >= 1 ) {
                                return(mark_as(TRUE))
                                }
                              return(mark_as(FALSE) )
                              }),
              incorrect = "Submitted",
              allow_retry = FALSE )
```

## Instructions

You have 50 minutes to complete this exam. The exam covers the material learned from Preface - Chapter 4. You are allowed one page of notes front and back.

Once you are finished:

-   Make sure your **name** is entered. If your name is not entered you will not receive a grade.
-   Make sure every question/exercise has been submitted.
-   In the submit section click the 'lock exam' button. You will not be able to make any changes once this is clicked. 
-   Once the exam is locked you will be able to click on the 'download exam' button.
-   Submit the completed html to Canvas.


## Concept (20 points)

```{r Q}
exam(
  shuffle = TRUE,
  caption = NULL,
  #Q1
  question_dropdown(
  paste("The following code is in a code chunk:", htmltools::img(src="images/00_math1.png", height = 75, width = 200), "<br> What is the output?"),
    answer(2),
    answer("TRUE"),
    answer("FALSE", TRUE),
    answer("NA"),
    answer("Error"),
    answer(0),
    allow_retry = TRUE,
    random_answer_order = TRUE,
    incorrect = "submitted"
  ),
  question_dropdown(
    "In a typical dataframe, columns correspond to ___.",
    answer("columns"),
    answer("observations"),
    answer("values"),
    answer("variables", correct = TRUE),
    answer("cells"),
    allow_retry = TRUE,
    random_answer_order = TRUE,
    incorrect = "submitted"
  ),
  question_wordbank(
  "Which of the following shows the... ",
  choices = c("relationship between one numerical variable and one categorical variable?", "distirbution of one categorical variable?"),
  wordbank = c("barplot", "faceted histogram", "stacked barplot", 
               "boxplot", "scatterplot"),
  answer(c("faceted histogram", "barplot"), correct = TRUE),
  allow_retry = TRUE,
  incorrect = "submitted"
  ),
  question_wordbank(
  paste("The table provides the first 8 observations from a sample of 200 individuals, who reported their age, race, income, and job satisfaction score on a scale from 0 to 100.", htmltools::img(src="images/01_tableB.png", height = 300, width = 500)),
  box = 8,
  choices = c("Which type of graphic would be most useful for visualizing the relationship between `Age` and `Score`??",
              "Which type of graphic would be most useful for visualizing the relationship between `Income` and `Gender`?"),
  wordbank = c("histogram", "scatterplot", "linegraph", "side-by-side boxplot", "stacked barplots"),
  answer(c("scatterplot", "stacked barplots"), correct = TRUE),
  allow_retry = TRUE,
  incorrect = "submitted"
  ),
  question_dropdown("Which of the following arguments in geom_bar()
  will separate stacked bars of different categories to be side-by-side when mapping 2 categorical variables?",
    answer("fill = `dodge`"),
    answer("position = `dodge`", correct = TRUE),
    answer("position = `fill`"),
    answer("fill = `shift`"),
    answer("fill = `position`"),
    allow_retry = TRUE,
    random_answer_order = TRUE,
    incorrect = "submitted"),
  question_dropdown(
    paste("The histogram below shows the distribution of a large classes exam grades out of 100. Which of the following statements is TRUE concerning this distribution?", htmltools::img(src="images/02_grades.png", height = 300, width = 500)),
    answer("The distribution is skewed left and the mean is less than the median.", correct = TRUE),  
    answer("The distribution is skewed right and the mean is less than the median."),
    answer("The distribution is skewed left and the mean is greater than the median."),
    answer("The distribution is skewed right and the mean is greater than the median."),
    answer("The distribution is symmetric and the mean is equal to the median."),
    allow_retry = TRUE,
    random_answer_order = TRUE,
    incorrect = "submitted"
  ),
  question_wordbank(
  paste("The histogram below shows the distribution of a large classes exam grades out of 100. How would the average grade change if the person with the lowest grade scored 5 percent better? How will the following statistics be impacted?", htmltools::img(src="images/02_grades.png", height = 300, width = 500)),
    choices = c("average/mean", "IQR (Interquartile Range)"),
    wordbank = c("increase", "decrease", "stay the same"),
    answer(c("increase", "stay the same"), correct = TRUE),
    allow_retry = TRUE,
    random_answer_order = TRUE,
    incorrect = "submitted"
  ),
  question_wordbank(
  "Match the following statistics with whether it measures centrality, variablity, both, or neither.",
    choices = c("Median", "Minimum", "Standard deviation"),
    wordbank = c("Centrality", "Variabiltiy/Spread", "Both Centrality and Variability", "Neither Centrality nor Variability"),
    answer(c("Centrality", "Neither Centrality nor Variability", "Variabiltiy/Spread"), correct = TRUE),
    allow_retry = TRUE,
    box = 4,
    arrange = "ordered",
    random_answer_order = FALSE,
    incorrect = "submitted"
  ),
  question_wordbank(
  "Which function/verb will...",
    type = "wordbank",
    choices = c("sort by a variable", "keep only desired variables", "perform an action per category"),
    wordbank = c("slice_max()", "count()", "mutate()", "group_by()", "filter()", "select()", "summarize()", "arrange()"),
    answer(c("arrange()", "select()", "group_by()"), correct = TRUE),
    allow_retry = TRUE,
    arrange = "ordered",
    incorrect = "submitted"
  ),
  question_wordbank(
  "Which function/verb is a...",
    choices = c("package used for data wrangling", "layer you add that controls the type of plot", "operator that adds layers to a plot"),
    wordbank = c("%>%", "aes()", "+", "%<%", "ggplot()", "geom_*()", "dplyr", "//", "ggplot2", "moderndive"),
    answer(c("dplyr", "geom_*()", "+"), correct = TRUE),
    allow_retry = TRUE,
    incorrect = "submitted"
  ),
  question_dropdown(
  "Suppose we have a dataset (some data) and we want to remove invalid data entries for one of the numerical variables and then proceed to calculate the median for that variable per level/category for a categorical variable. Which general sequence of functions/verbs would achieve this?",
    answer("some data %>% filter() %>% group_by() %>% summarize()", correct = TRUE),
    answer("some data %>% filter() %>% count()"),
    answer("some data %>% select() %>% group_by() %>% summarize()"),
    answer("some data %>% select() %>% count()"),
    answer("some data %>% arrange() %>% group_by() %>% summarize()"),
    answer("some data %>% arrange() %>% count()"),
    allow_retry = TRUE,
    incorrect = "submitted"
  )
)

```


## Application (15 points)

The following applications use the `survey` dataset which has been preloaded for you. All necessary libraries have been preloaded for you.

This contains the responses to the questions you answered on day 1 of class. For a detailed description of the variables and data click the Section titled "survey Data". You are welcome to use the Help feature of RStudio Cloud if needed.

For each application **only output/print the requested information**. If you are outputting miscellaneous information there will be a deduction.

### Application 1 (5 points)

Construct a scatterplot of `followers_tiktok` by `followers_insta`. Set the `color` equal to `procrastinator`.

```{r App1, exercise=TRUE}

```

```{r App1-solution, exercise.reveal_solution = FALSE}
ggplot(survey, aes(x = followers_insta, y = followers_tiktok, color = procrastinator)) +
  geom_point()
```

```{r App1-code-check}
grade_this_code(
  correct = "Submitted",
  incorrect = "Submitted"
)
```

In **one sentence** describe the relationship between the number of followers a student has on Instagram and Tiktok. In **one sentence** state why you are or are not surprised by this relationship.

```{r App1-desc}
question_text("", incorrect = "submitted",
              answer("ManuallyGradedEverythingWrong", 
                     correct = TRUE),
              allow_retry = TRUE,
              rows = 6)
```


### Application 2 (4 points)

Let's determine if North campus, South campus, or off campus students (Neither) attend more parties. Don't include First year students because they are new to school and may not know people yet.

In other words,

- start with the `survey` data
- exclude student's that have `school_year` of "First year"
- compute the average (mean) of `num_party` by `campus_housing`.
- Print the results in ascending order (low to high).

```{r App2, exercise=TRUE}

```


```{r App2-solution, exercise.reveal_solution = FALSE}
survey %>% 
  filter(school_year != "First year") %>% 
  group_by(campus_housing) %>% 
  summarize(mean = mean(num_party)) %>% 
  arrange(mean)
```

```{r App2-code-check}
grade_this_code(
  correct = "Submitted",
  incorrect = "Submitted"
)
```

### Application 3 (2 points)

Using the `survey` dataset...

- create a new variable called `height_feet` which is computed as `height_inches`/12
- subset the dataset to only contain the columns: `quarter`, `height_inches`, `height_feet`
- make sure you print/output the results

```{r App3, exercise=TRUE}

```


```{r App3-solution, exercise.reveal_solution = FALSE}
survey %>% 
  mutate(height_feet = height_inches/12) %>% 
  select(quarter, height_inches, height_feet)
```

```{r App3-code-check}
grade_this_code(
  correct = "Submitted",
  incorrect = "Submitted"
)
```

### Application 4 (4 points)

Let's determine if people who `smoke_weed` are happier.

Below we created a `survey_party` dataset which has NA values removed and removed the student's who "Don't know" whether or not they are happy.

Now, construct a barplot of `happy` with `fill` equal to `smoke_weed` using the `survey_party` dataset. 

The counts will distort this interpretation so set the `position` argument that will represent a **proportion** (ie: all bars should be filled to the top at 1).

```{r App4, exercise=TRUE}
survey_party <- survey %>% 
  filter(!is.na(smoke_weed), happy != "Don't know")


```


```{r App4-solution, exercise.reveal_solution = FALSE}
survey_party <- survey %>% 
  filter(!is.na(smoke_weed), happy != "Don't know")

ggplot(survey_party, aes(x = happy, fill = smoke_weed)) +
  geom_bar(position = "fill")
```

```{r App4-code-check}
grade_this_code(
  correct = "Submitted",
  incorrect = "Submitted"
)
```

Based on the barplot, conclude if this leads you to believe that people who smoke weed are happier.

```{r App4-desc}
question_text("", incorrect = "submitted",
              answer("ManuallyGradedEverythingWrong", 
                     correct = TRUE),
              allow_retry = TRUE,
              rows = 10)
```

## survey Data

You are welcome to open the dataset in RStudio Cloud as well if the information provided below is not sufficient for you.

Variables:

- `quarter` -- Identifies in which quarter the student took stat 202 (winter 2023, fall 2022, summer 2022, spring 2022, winter 2022, fall 2021)
- `gender_ident` -- "Which gender do you identify as (Male, Female). "Other" was removed to protect against the possibility of having their responses identified by other students.""
- `school_year` -- "What year are you in school? (First year, Sophomore, Junior, Senior, Other)"
- `num_party` -- "On average (approx.) how many parties a month do you attend?"
- `procrastinator` -- "Do you consider yourself a procrastinator? (Yes, No)"
- `height_inches` -- "How tall are you? (in inches)"
- `happy` -- "How happy are you? (Very happy, Pretty happy, Not too happy, Don't know)"
- `campus_housing` -- "Where do you live on campus? (North campus, South campus, Neither)"
- `smoke_weed` -- "Do you smoke weed? (Yes, Occasionally, No)"
- `followers_insta` -- "How many followers do you have on Instagram (approx.)?""
- `followers_tiktok` -- "How many followers do you have on TikTok (approx.)?""
- `salary` -- "What do you expect your starting salary to be after graduation, to the nearest thousand dollars? (ex: 47,000)"

```{r}
glimpse(survey)
```

```{r}
skim(survey)
```

## Submit

Once you are finished:

-   **No Name = 0 grade**
-   Click the 'lock' button below. Once you click this you will not be able to make any changes to your exam!
-   Once the lock is pressed a `print` option will become available
-   Click print and submit the downloaded html to Canvas.

```{r}
lock_button_ui(id = "lock")
```


<!-- ## Reset Exam -->

<!-- This button will reset the entire exam. Do not click unless absolutely necessary. -->
<!-- This is just here as an emergency option for frozen exams until I have ensured all the bugs are worked out. -->

<!-- ```{r} -->
<!-- reset_button_ui(id = "reset", label = "Reset Exam") -->
<!-- ``` -->

