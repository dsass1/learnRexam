---
title: "Exam 2"
tutorial:
  id: "isds_exam2b"
  version: 0.2
  
output:
  learnr::tutorial:
    progressive: false
    allow_skip: true
    css: ["css/nu-theme.css"]
runtime: shiny_prerendered
description: >
  This proficiency exam covers Chapter 5 - Chapter 8.
---

```{r setup, include=FALSE}
library(learnr)
library(tidyverse)
library(tutorialExtras)
library(gradethis)
library(skimr)
library(moderndive)

gradethis_setup(pass = "submitted",
                fail = "submitted",
                error_checker.message = "submitted",
                fail.hint = FALSE
                )

tutorialExtras_setup(is_exam = TRUE)

knitr::opts_chunk$set(echo = FALSE)

survey <- read_rds("data/survey.rds")
# 
# survey <- exam_data %>%
#   mutate(
#     height_inches = ifelse(height_inches < 42, NA,
#                            ifelse(height_inches > 84, NA,
#                                   height_inches)),
#     mother_height = ifelse(mother_height < 42, NA,
#                            ifelse(mother_height > 84, NA,
#                                   mother_height)),
#     father_height = ifelse(father_height < 42, NA,
#                            ifelse(father_height > 84, NA,
#                                   father_height)),
#     num_party = ifelse(num_party > 25, NA,
#                        ifelse(num_party < 0, NA, num_party)),
#     followers_tiktok = ifelse(followers_tiktok == 0, NA,
#                               ifelse(followers_tiktok > 4000, NA, followers_tiktok)),
#     followers_insta = ifelse(followers_insta == 0, NA,
#                               ifelse(followers_insta > 5000, NA, followers_insta))
#     #salary = ifelse(salary < 500000, salary, NA)
#     ) %>%
#   mutate(fav_drink = relevel(factor(fav_drink), ref = "don't_drink")) %>%
#   select(quarter, gender_ident, school_year, num_party, fav_drink, personality,
#           campus_housing, height_inches,
#          #mother_height, father_height,
#          followers_insta, followers_tiktok,
#          exercise, athlete)
# 
# write_rds(survey, "survey.rds")
#write_csv(survey, "survey.csv")

```



```{r, context = "server"}
lock_server("lock", 
            ex = c("App1", "App2a", "App2b", "App2c", "App2e", "App3a", "App3b"), 
            ex_pts = c(1, 2, 2, 2, 2, 2, 2),
            manual = c("App2-desc", "App4-desc"), 
            manual_pts = c(1, 1),
            exclude = c("Name") )
```

```{r Name}
# student name
question_text("Name:",
              answer_fn(function(value){
                              if(length(value) >= 1 ) {
                                return(mark_as(TRUE))
                                }
                              return(mark_as(FALSE) )
                              }),
              correct = "submitted",
              incorrect = "submitted",
              allow_retry = FALSE )
```

## Instructions

You have 50 minutes to complete this exam. The exam covers the material learned from Chapter 5 - Chapter 8. You are allowed one page of notes front and back.

Once you are finished:

-   **Check Submissions** to make sure every question/exercise has been submitted.
-   Click the **Lock Exam** button. You will not be able to make any changes once this is clicked. 
-   Once the exam is locked you will be able to click on the **Download Exam** button.


## Concept (15 points)

```{r Q}
exam(
  shuffle = TRUE,
  caption = NULL,
  #Q1
  question_dropdown(
  "Consider a dataset of observations with a variable for time spent running and distance traveled. <br>
  Choose the option that best describes the correlation between distance traveled and time spent running.",
    answer("Exactly -1"),
    answer("Between -1 and 0"),
    answer("About 0"),
    answer("Between 0 and 1", correct = TRUE),
    answer("Exactly +1"),
    allow_retry = TRUE,
    random_answer_order = FALSE,
    correct = "submitted",
    incorrect = "submitted",
    options= list(multi_part = "cor")),
  question_dropdown(
    paste("Examine the graph below and then select the best estimate of the correlation. <br>", htmltools::img(src="images/cor_2.png", height = 200, width = 200)),
    answer("-0.70"),
    answer("-0.25", correct = TRUE),
    answer("0"),
    answer("0.25"),
    answer("0.70"),
    allow_retry = TRUE,
    random_answer_order = TRUE,
    correct = "submitted",
    incorrect = "submitted",
    options= list(multi_part = "cor")
  ),
  question_dropdown(
  paste("You run a simple linear regression model to predict student SAT math scores (`sat_math`) based on the state's percentage of seniors/juniors taking the SAT (pct_taking). The model fitted value and residual for 5 states were added to the dataset and are shown below. <br>", htmltools::img(src="images/lm_sat_3.png", height = 150, width = 500), "<br> Did the model over-, under-, or correctly estimate the mean SAT math score for OR (Oregon)?"),
    answer("over-estimate"),
    answer("under-estimate", correct = TRUE),
    answer("correct estimate"),
    allow_retry = TRUE,
    random_answer_order = TRUE,
    correct = "submitted",
    incorrect = "submitted",
    options= list(multi_part = "lm")
  ),
  question_dropdown(
  "Using the simple linear regression model output above... which of the five states does the model estimate worst?",
    answer("AZ"),
    answer("IL"),
    answer("ND", correct = TRUE),
    answer("OR"),
    answer("SC"),
    allow_retry = TRUE,
    correct = "submitted",
    incorrect = "submitted",
    options= list(multi_part = "lm")
  ),
  question_numeric(
  "Again using the simple linear regression model output above... what is the fitted/predicted value for Illinois (`IL`)?",
    answer(553.79, correct = TRUE),
    allow_retry = TRUE,
    step = 0.01,
    correct = "submitted",
    incorrect = "submitted",
    options= list(multi_part = "lm")
  ),
  question_wordbank("Consider the following model where age and marital status (single, married) are the explanatory/predictor variables to predict household income. The reference group for marital status is **single**. <br>
  $\\widehat{income} = b_0 + b_1(age) + b_2(marital status) + b_3(age*marital status)$",
  choices = c("What is the correct interpretation for \\(b_0\\)?",
              "What is the correct interpretation for \\(b_3\\)?"),
  wordbank = c("offset in intercept for single marital status", 
               "offset in intercept for married marital status",
               "intercept for single marital status", 
               "intercept for married marital status", 
               "offset in slope of age for single marital status",
               "offset in slope of age for married marital status", 
               "slope of age for single marital status", 
               "slope of age for married marital status"),
    answer(c("intercept for single marital status", "offset in slope of age for married marital status"), correct = TRUE),
    allow_retry = TRUE,
    random_answer_order = FALSE,
    correct = "submitted",
    incorrect = "submitted"
  ),
  question_dropdown(
  paste("You build a multiple regression model that predicts a professor's salary (salary) based on their years of service (years). You are curious if sex may also impact the professor's salary. The variable sex is an indicator variable where sex = 1 if the professor is Male and sex = 0 if the professor is female. The regression output equation is given below <br> <br>
  $\\widehat{salary} = 82 +1.6(years) +21.4(sex) - 0.9(years)*(sex)$ 
  <br> Which graph best matches the model? <br> <br>
        a)", htmltools::img(src="images/reg_salary_1.png", height = 150, width = 200),
        "&nbsp; b)", htmltools::img(src="images/reg_salary_2.png", height = 150, width = 200)," <br>
        c)", htmltools::img(src="images/reg_salary_3.png", height = 150, width = 200),
        " &nbsp; d)", htmltools::img(src="images/reg_salary_4.png", height = 150, width = 200) ),
    answer("a"),
    answer("b", correct = TRUE),
    answer("c"),
    answer("d"),
    allow_retry = TRUE,
    random_answer_order = FALSE,
    correct = "submitted",
    incorrect = "submitted"
  ),
  question_dropdown(
  "You want to evaluate whether in-person classes or on-line classes provide better learning outcomes for STAT 202.  Students choose if and when they take STAT 202. From the students that choose to take the class you randomly assign half of the students to the in-person class and half the students to the on-line class and compare the test scores in each section. What conclusions can we draw from this experiment?" ,
    answer("causal conclusions generalized to the University"),
    answer("no causal conclusions, correlation statement generalized to the University"),
    answer("no causal conclusions, correlation statement only applicable to our sample"),
    answer("causal conclusions only applicable to our sample", correct = TRUE),
    allow_retry = TRUE,
    random_answer_order = TRUE,
    correct = "submitted",
    incorrect = "submitted"
  ),
  question_wordbank("Northwestern is interested in understanding the quality of athletics at the school. Identify the type of sampling method used:",
    choices = c("Northwestern randomly chooses 3 sports teams and surveys all athletes on that team",
                "Northwestern puts the names of every student athlete into a hat and randomly selects 50 names."),
    box = 8,
    wordbank = c("simple random", "cluster", "stratified", "systematic", "none of these"),
    answer(c("cluster","simple random"), correct = TRUE),
    allow_retry = TRUE,
    random_answer_order = TRUE,
    correct = "submitted",
    incorrect = "submitted"
   ),
  question_radio(
  "To study job satisfaction of data scientists, a researcher obtained the email of all data scientists at the top 5 tech companies and emailed them a voluntary survey. The researcher computed an average job satisfaction level of 7 (on a scale of 1 to 10). <br>
  What notation best describes the computed job satisfaction level of 7?" ,
    answer("$\\hat{\\pi}$"),
    answer("$s$"),
    answer("$\\mu$"),
    answer("$\\pi$"),
    answer("$\\bar{x}$", correct = TRUE),
    allow_retry = TRUE,
    random_answer_order = TRUE,
    correct = "submitted",
    incorrect = "submitted",
    options= list(multi_part = "gen")
  ),
  question_dropdown(
  "Based on the question above. <br>
  The results can be generalized to..." ,
    answer("all data scientists"),
    answer("only our sample", correct = TRUE),
    answer("all data scientists at the top 5 tech companies"),
    answer("all people with a degree in data science"),
    allow_retry = TRUE,
    random_answer_order = TRUE,
    correct = "submitted",
    incorrect = "submitted",
    options= list(multi_part = "gen")
  ),
  question_dropdown(
  "Suppose you want to study if adults who prefer to drink beer, wine, and water differ in terms of their mean weights. Data were collected from a random sample of World Campus students to address the research question above. The researchers found that adults who preferred beer tended to weigh more than those who preferred wine. Which one of the following interpretations is the most appropriate?",
    answer("Adults who drink beer weigh more because they develop what is known as a beer belly."),
    answer("More adults should drink wine because it causes you to weigh less."),
    answer("Beer causes adults to weigh more because there were no confounding variables found in the dataset."),
    answer("There could be a confounding variable such as gender, that explains the difference in weight between beer and wine drinkers.", correct = TRUE),
    answer("You cannot draw any valid conclusions because the sample sizes are different between each group."),
    allow_retry = TRUE,
    random_answer_order = TRUE,
    correct = "submitted",
    incorrect = "submitted"
  ),
  question_dropdown(
  "Consider the following sampling design. You are working on a hospital improvement team and want to understand the job satisfaction of nurses at hospitals in the Chicagoland area. There are 107 hospitals, you cannot possibly survey all of these hospitals so you randomly select 3 hospitals and survey all of the nurses in those hospitals. Is this a good sampling design?",
    answer("Yes, since random sampling is used to select the 3 hospitals this is a good sampling design."),
    answer("Yes, the stratums are likely heterogenous (mini representations of the population) meaning selecting 3 stratums is a good sampling design."),
    answer("No, the groups are likely homogenous (within each stratum people share a characteristic) and stratified sampling would be more appropriate.", correct = TRUE),
    answer("No, while the stratums are heterogenous (mini representation of the population) we should do random sampling within each cluster to make a fair representation."),
    allow_retry = TRUE,
    random_answer_order = TRUE,
    correct = "submitted",
    incorrect = "submitted"
  )
  # question_dropdown(
  #   "Q19) Prof. Sass surveys all of her Introductory STAT 202 students to determine student satisfaction with Northwestern's academics. What type of sample is this?",
  #   answer("cluster sampling"),
  #   answer("simple random sample"),
  #   answer("systematic sampling"),
  #   answer("stratified sampling"),
  #   answer("none of these", correct = TRUE),
  #   allow_retry = TRUE,
  #   random_answer_order = TRUE,
  #   correct = "submitted",
  #   incorrect = "submitted"
  # ),
  # question_dropdown(
  #   "Q20) From Q19, Prof. Sass learns from the survey that on average students ranked Northwestern's academic program 7.5 out of 10.",
  #   answer("This is likely an accurate estimate because a large proportion of the student body takes STAT 202 at some point in their academic career."),
  #   answer("This is likely too high of an estimate because of under-coverage in upper classmen", correct = TRUE),
  #   answer("This is likely too low of an estimate because of under-coverage in first year students."),
  #   answer("This is likely an accurate estimate because it is random who takes STAT 202 each quarter."),
  #   allow_retry = TRUE,
  #   random_answer_order = TRUE,
  #   correct = "submitted",
  #   incorrect = "submitted"
  # )
  
)

```


## Application (20 points)

The following applications use the `survey` dataset which has been preloaded for you.  All necessary libraries have been pre-loaded for you.

This contains the responses to the questions you answered on day 1 of class. For a detailed description of the variables and data click the Section titled "survey Data". You are welcome to use the Help feature of Posit Cloud if needed.

<br>

For each application **only output/print the requested information**. If you are outputting miscellaneous information there will be a deduction because it demonstrates a lack of understanding.

<br>

### Application 1 (1 points)

A file named `survey.csv` is located in a `data/` subdirectory. Use the appropriate `readr` function to read in the dataset and store it as `survey`.

```{r App1, exercise=TRUE}

```

```{r App1-solution, exercise.reveal_solution = FALSE}
survey <- read_csv("data/survey.csv")
```

```{r App1-check}
grade_this_code(
  correct = "submitted",
  incorrect = "submitted"
)
```

*All applications will still run even if this is incorrect.*

### Application 2 (10 points)

**Part 1**

Calculate the correlation between `followers_tiktok` and `followers_insta` using the `survey` dataset.

```{r App2a, exercise=TRUE}

```


```{r App2a-solution, exercise.reveal_solution = FALSE}
survey %>% 
  select(followers_tiktok, followers_insta) %>% 
  cor(use = "complete.obs")
```

```{r App2a-check}
grade_this_code(
  correct = "submitted",
  incorrect = "submitted"
)
```

<br>

**Part 2**

Visualize the relationship of `followers_tiktok` by `followers_insta` and add the **line of best fit**.

```{r App2b, exercise = TRUE}
  
```


```{r App2b-solution, exercise.reveal_solution = FALSE}
ggplot(survey, aes(followers_insta, followers_tiktok)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE)
```

```{r App2b-check}
grade_this_code(
  correct = "submitted",
  incorrect = "submitted"
)
```
<br>

**Part 3**

Build a simple linear regression model that predicts `followers_tiktok` using `followers_insta`. Store the model as `model_followers`. Output the model results using the `summary()` function. 

```{r App2c, exercise = TRUE}

```


```{r App2c-solution, exercise.reveal_solution = FALSE}
model_followers <- lm(followers_tiktok ~ followers_insta, data = survey)

summary(model_followers)
```

```{r App2c-check}
grade_this_code(
  correct = "Submitted",
  incorrect = "Submitted"
)
```
<br>

**Part 4**

Interpret the **slope** in the context of the problem.

```{r App2-desc}
question_text("", incorrect = "submitted",
              answer("ManuallyGradedEverythingWrong", 
                     correct = TRUE),
              allow_retry = TRUE,
              rows = 5)
```

<br>

**Part 5**

Add the fitted values from your model called `model_followers` to the code below. The code is started for you to remove missing values. Now you need to:

1. `select` only the variables `followers_tiktok` and `followers_insta`
2. Then add a new variable called `fitted` which are equal to the fitted values from the model
3. Make sure your results are being output/printed

*You can complete this even if Part 3 is incorrect.*

```{r App2-setup}
model_followers <- lm(followers_tiktok ~ followers_insta, data = survey)
```

```{r App2e, exercise = TRUE, exercise.lines =4, exercise.setup = "App2-setup"}
survey %>% 
  filter(!is.na(followers_tiktok), !is.na(followers_insta))
```


```{r App1e-solution, exercise.reveal_solution = FALSE}
survey %>% 
  filter(!is.na(followers_tiktok), !is.na(followers_insta)) %>% 
  select(followers_tiktok) %>% 
  mutate(fitted = fitted(model_followers))
```

```{r App1e-check}
grade_this_code(
  correct = "Submitted",
  incorrect = "Submitted"
)
```

### Application 3 (4 points)

**Part 1**

Build a multiple regression model **with an interaction term** to predict `followers_tiktok` based on `followers_insta` and `personality`. 

Output the model results using the `summary()` function. 

The variable `personality` has 2 levels: {Extrovert, Introvert}

```{r App3a, exercise = TRUE}

```


```{r App3a-solution, exercise.reveal_solution = FALSE}
model_ex <- lm(followers_tiktok ~ followers_insta * personality, data = survey)

summary(model_ex)
```

```{r App3a-check}
grade_this_code(
  correct = "submitted",
  incorrect = "submitted"
)
```
<br>

**Part 2**

Suppose a student has 500 Instagram followers (`followers_insta` = 500) and is an introvert (`personality` = `Introvert`). How many TikTok followers do we predict this student has?

Use the code chunk below as a calculator to output your prediction (the multiplication symbol is *).

```{r App3b, exercise = TRUE}

```


```{r App3b-solution, exercise.reveal_solution = FALSE}
-16.13971 +0.13548*500 -51.73801 +0.04944*500*1
```

```{r App3b-check}
grade_this_code(
  correct = "Submitted",
  incorrect = "Submitted"
)
```
<br>


### Application 4 

Using our `survey` dataset, we built a simple regression model to predict `num_party` based on `fav_drink`. Recall `num_party` represents the number of parties a student attends each month.

The model results are shown below:

```{r}
model_party <- lm(num_party ~ fav_drink, survey)

summary(model_party)$coefficients
```


**Part 1 (3 points)**

```{r App4}
question_wordbank(
  paste("Using the model output above to answer the following questions. The variable `fav_drink` has 4 levels: {beer, don't_drink, hard_liquor, wine} <br>") ,
  choices = c("What is the baseline/reference level?",
            HTML("Students with what <code>fav_drink</code> level are predicted to on average go to the <b>LEAST</b> number of parties a month?"),
            HTML("Students with what <code>fav_drink</code>  level are predicted to on average go to the <b>MOST</b> number of parties a month?") ),
  wordbank = c("beer", "don't_drink", "hard_liquor", "wine"),
  answer(c("wine","hard_liquor","beer"), correct = TRUE),
    allow_retry = TRUE,
    random_answer_order = TRUE,
    correct = "submitted",
    incorrect = "submitted"
  )
```

**Part 2 (2 points)**

Interpret the coefficient labeled **fav_drinkwine** in the **context of the problem**.

```{r App4-desc}
question_text("", incorrect = "submitted",
              answer("ManuallyGradedEverythingWrong", 
                     correct = TRUE),
              allow_retry = TRUE,
              rows = 5)
```


## survey Data

You are welcome to open the dataset in Posit Cloud as well if the information provided below is not sufficient for you.

Variables:
 
- `quarter` -- Identifies in which quarter the student took stat 202 (fall 2023, summer 2023, spring 2023, winter, 2023, fall 2022, summer 2022, spring 2022, winter 2022, fall 2021)
- `gender_ident` -- "Which gender do you identify as (Male, Female). "Other" was removed to protect against the possibility of having their responses identified by other students."
- `school_year` -- "What year are you in school? (First year, Sophomore, Junior, Senior, Other)"
- `num_party` -- "On average (approx.) how many parties a month do you attend?"
- `fav_drink` -- "What is your alcoholic drink of choice? (beer, don't drink, hard_liquor, wine)"
- `personality` -- "Are you more of an introvert or extrovert? (Introvert, Extrovert)"
- `campus_housing` -- "Where do you live on campus? (North campus, South campus, Neither)"
- `height_inches` -- "How tall are you? (in inches)"
- `followers_insta` -- "How many followers do you have on Instagram? (approx)?"
- `followers_tiktok` -- "How many followers do you have on TikTok? (approx)?"
- `exercise` -- "Approximately, how many minutes do you spend exercising per week?"
- `athlete` -- "Are you a student athlete? (No, Yes)"


```{r}
glimpse(survey)
```

```{r}
skim(survey)
```


## Submit


Once you are finished:

-   Click "Check submissions" to make sure all questions and exercises are submitted -- **Un-submitted questions will receive a 0.**
-   Once all questions/exercises are submitted click the **Lock Exam** button. Once you click this you will not be able to make any changes to your exam!
-   Once the lock is pressed a **Download Exam** option will become available,
-   Download and **Check your HTML!**
-   Upload the html to Canvas.

```{r}
lock_check_ui(id = "lock")
```
<br>
```{r}
lock_button_ui(id = "lock")
```